<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <title>GeoQuads</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --bg: #f7f9fb;
      --card: #ffffff;
      --ink: #1f2937;
      --muted: #6b7280;
      --accent: #4f46e5;
      --accent-weak: #e0e7ff;
      --danger: #dc2626;
      --ok: #059669;
      --border: #e5e7eb;
      --selected: #dbeafe; /* ανοικτό μπλε */
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 16px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--ink); background: var(--bg);
    }
    .wrap { max-width: 900px; margin: 0 auto; }
    header {
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      margin-bottom: 12px;
    }
    h1 { margin:0; font-size: 28px; }
    .sub { color: var(--muted); font-size: 14px; }
    .corner-actions { display:flex; align-items:center; gap:8px; }
    .chip { font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:var(--card); cursor:pointer; }
    .chip.spoiler { filter: blur(3px); }
    .chip.revealed { filter: none; background: var(--accent-weak); }
    .help { cursor:pointer; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:var(--card); }

    .panel { background:var(--card); border:1px solid var(--border); border-radius:14px; padding:14px; }
    .solved { display:grid; gap:8px; margin:10px 0 14px; }
    .bar {
      display:flex; align-items:center; justify-content:space-between; gap:8px;
      padding:10px 12px; border:1px solid var(--border); border-radius:12px;
      background:#ecfdf5; /* πρασινωπό για solved */
    }
    .bar .name { font-weight:600; }
    .bar .items { color: var(--muted); font-size: 14px; }

    .grid { display:grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap:10px; }
    .cell {
      background: var(--card);
      border:2px solid var(--border);
      padding:14px; border-radius:12px;
      text-align:center; cursor:pointer; user-select:none;
      min-height:60px; display:flex; align-items:center; justify-content:center;
    }
    .cell.selected { background: var(--selected); border-color:#93c5fd; }
    .controls { display:flex; flex-wrap:wrap; gap:8px; margin:12px 0; }
    button {
      padding:10px 16px; border-radius:999px; border:1px solid var(--border);
      background: var(--card); cursor:pointer;
    }
    button.primary { background: var(--accent); color: white; border-color: var(--accent); }
    button:disabled { opacity: 0.5; cursor:not-allowed; }
    .status {
      display:flex; align-items:center; justify-content:space-between; gap:8px;
      font-size:14px; color: var(--muted); min-height: 24px;
    }
    .lives { color: var(--danger); font-weight:600; }
    .ok { color: var(--ok); }
    .msg { color: var(--ink); }
    .footer {
      margin-top: 14px; font-size: 13px; color: var(--muted);
      display:flex; align-items:center; justify-content:space-between; gap:8px;
    }
    .linkish { color: var(--accent); text-decoration: underline; cursor:pointer; }
    @media (max-width: 520px) {
      .grid { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>GeoQuads</h1>
        <div class="sub" id="today"></div>
      </div>
      <div class="corner-actions">
        <div id="spoiler" class="chip spoiler" title="Πάτα για υπόνοια">Spoiler: Σκέψου κατηγορίες όπως πρωτεύουσες / ποτάμια.</div>
        <div class="help" id="help">?</div>
      </div>
    </header>

    <!-- Solved category bars appear here -->
    <div id="solved" class="solved"></div>

    <!-- Game panel -->
    <div class="panel">
      <div id="grid" class="grid" aria-label="Τα 16 πλακίδια"></div>

      <div class="controls">
        <button id="clearBtn">Clear</button>
        <button id="submitBtn" class="primary" disabled>Submit</button>
        <button id="shuffleBtn">Shuffle</button>
      </div>

      <div class="status">
        <div id="message" class="msg"></div>
        <div>Λάθη: <span id="mistakes" class="lives">0</span>/4</div>
      </div>
    </div>

    <div class="footer">
      <div>⏱️ Επόμενο daily σε: <span id="countdown">--:--:--</span></div>
      <div>
        <span class="linkish" id="practice">Practice</span> ·
        <span class="linkish" id="archive">Archive</span>
      </div>
    </div>
  </div>

  <script>
    // ====== ΔΕΔΟΜΕΝΑ ΠΑΖΛ (δείγμα) ======
    const puzzle = {
      id: "demo-001",
      groups: [
        { name: "Πρωτεύουσες Ευρώπης", items: ["Αθήνα", "Ρώμη", "Λονδίνο", "Παρίσι"] },
        { name: "Μεγάλα Ποτάμια",      items: ["Νείλος", "Αμαζόνιος", "Δούναβης", "Μισισιπής"] },
        { name: "Χώρες Ευρώπης",        items: ["Ελβετία", "Ελλάδα", "Γαλλία", "Ιταλία"] },
        { name: "Ορεινά Συγκροτήματα",  items: ["Άλπεις", "Πίνδος", "Καύκασος", "Ιμαλάια"] },
      ]
    };

    // ====== ΚΑΤΑΣΤΑΣΗ ΠΑΙΧΝΙΔΙΟΥ ======
    let tiles = [];             // [{label, groupIndex, id}]
    let selected = new Set();   // indices στο current tiles
    let solvedGroups = new Set(); // groupIndex που λύθηκαν
    let mistakes = 0;
    const MAX_MISTAKES = 4;

    // ====== ΕΡΓΑΛΕΙΑ ======
    function shuffleArray(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function buildTiles() {
      const base = [];
      puzzle.groups.forEach((g, gi) => {
        g.items.forEach((label, idx) => {
          base.push({ label, groupIndex: gi, id: `${gi}-${idx}` });
        });
      });
      return shuffleArray(base);
    }

    function renderSolvedBars() {
      const container = document.getElementById("solved");
      container.innerHTML = "";
      [...solvedGroups].forEach(gi => {
        const g = puzzle.groups[gi];
        const bar = document.createElement("div");
        bar.className = "bar";
        bar.innerHTML = `
          <div class="name">${g.name}</div>
          <div class="items">${g.items.join(" · ")}</div>
        `;
        container.appendChild(bar);
      });
    }

    function renderGrid() {
      const grid = document.getElementById("grid");
      grid.innerHTML = "";
      tiles.forEach((t, idx) => {
        const btn = document.createElement("div");
        btn.className = "cell" + (selected.has(idx) ? " selected" : "");
        btn.textContent = t.label;
        btn.tabIndex = 0;
        btn.addEventListener("click", () => toggleSelect(idx));
        btn.addEventListener("keydown", (e) => {
          if (e.key === " " || e.key === "Enter") { e.preventDefault(); toggleSelect(idx); }
        });
        grid.appendChild(btn);
      });
      updateSubmitState();
    }

    function updateSubmitState() {
      document.getElementById("submitBtn").disabled = selected.size !== 4 || isGameOver();
      document.getElementById("mistakes").textContent = mistakes;
    }

    function setMessage(text, ok=false) {
      const el = document.getElementById("message");
      el.textContent = text || "";
      el.className = "msg" + (ok ? " ok" : "");
    }

    function isGameOver() {
      return mistakes >= MAX_MISTAKES || solvedGroups.size === 4;
    }

    // ====== ΕΠΙΛΟΓΕΣ / ΣΥΜΠΕΡΙΦΟΡΑ ======
    function toggleSelect(idx) {
      if (isGameOver()) return;
      if (selected.has(idx)) selected.delete(idx);
      else if (selected.size < 4) selected.add(idx);
      setMessage("");
      renderGrid();
    }

    function clearSelection() {
      selected.clear();
      setMessage("");
      renderGrid();
    }

    function shuffleTiles() {
      if (isGameOver()) return;
      // Shuffle μόνο τα υπόλοιπα tiles
      tiles = shuffleArray(tiles);
      selected.clear();
      setMessage("");
      renderGrid();
    }

    function checkSelection() {
      if (selected.size !== 4 || isGameOver()) return;
      const chosen = [...selected].map(i => tiles[i]);
      const g0 = chosen[0].groupIndex;
      const allSame = chosen.every(c => c.groupIndex === g0);

      if (allSame) {
        // ΣΩΣΤΟ: κλειδώνουμε ομάδα
        solvedGroups.add(g0);
        setMessage("Σωστό! Βρήκες κατηγορία.", true);

        // Αφαιρούμε τα tiles της ομάδας από το board
        const labelsToRemove = new Set(puzzle.groups[g0].items);
        tiles = tiles.filter(t => !labelsToRemove.has(t.label));
        selected.clear();

        // Εμφάνιση μπάρας κατηγορίας
        renderSolvedBars();
        renderGrid();

        if (solvedGroups.size === 4) {
          endGame(true);
        }
      } else {
        // ΛΑΘΟΣ: έλεγξε «one away»
        if (isOneAway(chosen)) {
          setMessage("One away! Είσαι μία λέξη μακριά.");
        } else {
          setMessage("Όχι ακριβώς — δοκίμασε ξανά.");
        }
        mistakes++;
        selected.clear();

        renderGrid();
        if (mistakes >= MAX_MISTAKES) {
          endGame(false);
        }
      }
    }

    function isOneAway(chosen) {
      // Αν 3 από 4 ανήκουν στην ίδια ομάδα → one away
      const counts = {};
      chosen.forEach(c => { counts[c.groupIndex] = (counts[c.groupIndex] || 0) + 1; });
      const max = Math.max(...Object.values(counts));
      return max === 3;
    }

    function endGame(won) {
      const remainingGroups = [0,1,2,3].filter(gi => !solvedGroups.has(gi));
      // Αυτόματη αποκάλυψη υπολοίπων
      remainingGroups.forEach(gi => solvedGroups.add(gi));
      renderSolvedBars();
      setMessage(won ? "Μπράβο! Τα βρήκες όλα." : "Τέλος παιχνιδιού. Δες τις κατηγορίες παραπάνω.");
      updateSubmitState();
    }

    // ====== ΒΟΗΘΕΙΑ / SPOILER / ΠΡΑΚΤΙΚΑ ======
    document.getElementById("help").addEventListener("click", () => {
      alert(
`Κανόνες:
• Υπάρχουν 16 λέξεις που σχηματίζουν 4 κατηγορίες × 4 λέξεις.
• Επίλεξε 4 λέξεις και πάτα Submit.
• Αν είναι σωστές, «κλειδώνουν» ως κατηγορία.
• Έχεις 4 λάθη συνολικά. «One away» σημαίνει ότι 3/4 είναι σωστά.
• Μπορείς να κάνεις Clear (αποεπιλογή) και Shuffle (ανακάτεμα).`
      );
    });

    const spoilerEl = document.getElementById("spoiler");
    spoilerEl.addEventListener("click", () => {
      spoilerEl.classList.toggle("revealed");
      spoilerEl.classList.toggle("spoiler");
    });

    document.getElementById("practice").addEventListener("click", () => {
      alert("Practice: θα βάλεις 2–3 δείγματα quiz εδώ ή σε ξεχωριστή σελίδα.");
    });
    document.getElementById("archive").addEventListener("click", () => {
      alert("Archive: σελίδα με παλιότερα daily quizzes (ανανεώνεται καθημερινά).");
    });

    // ====== COUNTDOWN μέχρι την τοπική 00:00 ======
    function updateCountdown() {
      const now = new Date();
      const nextMidnight = new Date(now);
      nextMidnight.setHours(24,0,0,0); // επόμενο 00:00 τοπικής ώρας
      const diff = nextMidnight - now;

      if (diff <= 0) {
        document.getElementById("countdown").textContent = "00:00:00";
        return;
      }
      const h = String(Math.floor(diff / 3_600_000)).padStart(2,"0");
      const m = String(Math.floor((diff % 3_600_000) / 60_000)).padStart(2,"0");
      const s = String(Math.floor((diff % 60_000) / 1000)).padStart(2,"0");
      document.getElementById("countdown").textContent = `${h}:${m}:${s}`;
    }
    setInterval(updateCountdown, 1000); updateCountdown();

    // ====== ΗΜΕΡΟΜΗΝΙΑ ======
    function formatDateHuman(d) {
      const opts = { day:"2-digit", month:"2-digit", year:"numeric" };
      return d.toLocaleDateString("el-GR", opts);
    }
    document.getElementById("today").textContent = `Σήμερα: ${formatDateHuman(new Date())}`;

    // ====== ΚΟΥΜΠΙΑ ======
    document.getElementById("clearBtn").addEventListener("click", clearSelection);
    document.getElementById("shuffleBtn").addEventListener("click", shuffleTiles);
    document.getElementById("submitBtn").addEventListener("click", checkSelection);

    // ====== ΕΝΑΡΞΗ ======
    function init() {
      tiles = buildTiles();
      selected.clear();
      solvedGroups.clear();
      mistakes = 0;
      renderSolvedBars();
      renderGrid();
      setMessage("");
    }
    init();
  </script>
</body>
</html>
